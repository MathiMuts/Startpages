{% extends "../../modules/_base.html" %}
{% load static %}

{% block title %}Startpage{% endblock title %}
{% block content %}

<!-- Scroll Snap Container -->
<div class="h-screen w-full overflow-y-scroll snap-y snap-mandatory scroll-smooth" id="main-scroll-container">

    <!-- Screen 1: Search & Preview Row (Snap Center) -->
    <div class="snap-start min-h-screen flex flex-col justify-center items-center w-full relative bg-neutral-50 dark:bg-neutral-900/50 py-12">
        
        <!-- Search Bar Container -->
        <div class="w-full max-w-2xl px-4 z-10 mb-12 pt-60 pb-40">
            {% include "../../components/_search-bar.html" %}
        </div>

        <!-- Preview Row (First row of sections) -->
        <div class="w-full px-4 mb-8"> 
             <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 
                        w-72 sm:w-152 md:w-232 lg:w-312 xl:w-392
                        gap-8 mx-auto p-4">
                
                {% for sec in sections|slice:":5" %}
                    {% include "../../components/_section.html" with section=sec is_preview=True %}
                {% endfor %}
            </div>
        </div>

        <!-- Scroll Indicator -->
        <div class="text-center text-neutral-400 animate-bounce cursor-pointer mt-auto" 
             onclick="document.getElementById('sections-grid').scrollIntoView({behavior: 'smooth'})">
            <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
        </div>
    </div>

    <!-- Screen 2: All Sections Grid (Snap Start) -->
    <div id="sections-grid" class="snap-start min-h-screen pt-24 pb-24 bg-neutral-100 dark:bg-neutral-900">
        
        <div class="text-center mb-8 text-neutral-500 text-sm">
            <span id="mode-indicator">Hold any item to Edit</span>
        </div>

        <div id="grid-container" 
             class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 
                    w-72 sm:w-152 md:w-232 lg:w-312 xl:w-392
                    gap-8 mx-auto pb-32">
            
            {% for sec in sections %}
                {% include "../../components/_section.html" with section=sec %}
            {% endfor %}
            
        </div>
    </div>

</div>

<!-- Include the new Modal Module -->
{% include "../../components/_edit-modal.html" %}

<!-- Toast Container for Notifications -->
<div id="toast-container" class="fixed bottom-5 right-5 z-[150] flex flex-col gap-2"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="{% static 'js/startpage_logic.js' %}"></script>

<script>
  function openAllLinksInSection(triggerElement) {
    const section = triggerElement.closest('section');
    if (section) {
      const linksToOpen = section.querySelectorAll('.section-links a');
      linksToOpen.forEach(link => {
        if (link.href) window.open(link.href, '_blank');
      });
    }
  }
</script>

<style>
    /* Edit Mode Visual Cues */
    
    /* Section Border */
    /* Border width is reserved in HTML (border-transparent), so we just change color/style */
    .edit-mode-active .draggable-section {
        border-color: #6366f1; /* Indigo-500 */
        border-style: dashed;
        cursor: grab;
        animation: pulse-border 2s infinite;
    }

    /* Link Borders */
    /* Border width is reserved in HTML (border-transparent), so we just change color */
    .edit-mode-active .draggable-link {
        border-color: #d4d4d4; /* neutral-300 */
    }
    .dark .edit-mode-active .draggable-link {
        border-color: #525252; /* neutral-600 */
    }

    /* Toggle Visibility Helpers */
    .edit-mode-active .edit-mode-hidden {
        display: none !important;
    }

    .edit-mode-active .edit-mode-visible {
        display: block !important;
    }

    /* Drag Overlay */
    .edit-mode-active .edit-mode-overlay {
        display: block !important;
    }

    /* Disable links while editing */
    .edit-mode-active .edit-mode-disable {
        pointer-events: none;
    }

    /* --- DRAGGING SPECIFICS --- */

    /* Hide the static '+' button when any drag operation is active */
    body.dragging-active .static-add-btn {
        display: none !important;
    }

    /* Sortable Ghost (Drag placeholder) - Dotted line style */
    .sortable-ghost {
        opacity: 0.5;
        background-color: transparent;
        border: 2px dotted #a3a3a3 !important; /* neutral-400 */
    }
    .dark .sortable-ghost {
        border-color: #737373 !important; /* neutral-500 */
    }

    @keyframes pulse-border {
        0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
        70% { box-shadow: 0 0 0 6px rgba(99, 102, 241, 0); }
        100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }
</style>

{% endblock %}