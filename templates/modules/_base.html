{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{% block title %}{% endblock title %}</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        {% tailwind_css %}
        <script>
            (() => {
              let theme;
              try {
                theme = localStorage.getItem('theme');
              } catch (e) {}

              if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
              } else {
                document.documentElement.classList.remove('dark');
              }
            })();
        </script>
    </head>

  <body class="bg-neutral-100 dark:bg-neutral-900 dark:text-white min-h-screen flex flex-col">
    <header class="fixed top-0 right-0 z-50 p-5">
      {% include "./_messages.html" %}
      {% if user.is_authenticated %}
        <a href="{% url 'startpages:profile' %}" 
           class="block w-10 h-10 rounded-full overflow-hidden border-2 border-transparent hover:border-indigo-500 transition-all shadow-lg hover:scale-105"
           title="Go to Profile">
            
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="Profile" class="w-full h-full object-cover">
            {% else %}
                <div class="w-full h-full bg-indigo-600 flex items-center justify-center text-white text-xs font-bold uppercase">
                    {{ user.username|slice:":2" }}
                </div>
            {% endif %}
        </a>
      {% else %}
          <a href="{% url 'login' %}" class="button-primary px-4 py-2 rounded text-white font-bold text-sm">Login</a>
      {% endif %}
    </header>
    
    <main class="flex-grow flex flex-col">
      {% block content %}{% endblock content %}
    </main>

  </body>
  <style>
    /* Edit Mode Visual Cues */
    .edit-mode-active .draggable-section {
        border: 1px dashed #6366f1; /* Indigo-500 */
        cursor: grab;
        animation: pulse-border 2s infinite;
    }

    .edit-mode-active .edit-mode-hidden {
        display: none !important;
    }

    .edit-mode-active .edit-mode-visible {
        display: block !important;
    }

    .edit-mode-active .edit-mode-overlay {
        display: block !important;
    }

    .edit-mode-active .edit-mode-disable {
        pointer-events: none;
    }

    @keyframes pulse-border {
        0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
        70% { box-shadow: 0 0 0 6px rgba(99, 102, 241, 0); }
        100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }
  </style>
</html>
