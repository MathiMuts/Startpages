<section 
    class="{% if not is_preview %}draggable-section{% endif %} 
           bg-white dark:bg-neutral-700 
           container px-6 py-4 flex flex-col gap-4 rounded-lg
           text-neutral-900 dark:text-neutral-200 w-full relative group
           transition-transform duration-200 select-none
           shadow-lg h-[30rem]
           border border-transparent"
    {% if not is_preview %}data-id="{{ section.id }}"{% endif %}
>
    <!-- Header -->
    <div class="flex justify-between items-center section-header {% if not is_preview %}cursor-grab active:cursor-grabbing{% endif %}">
        <h2 class="text-2xl font-bold truncate pointer-events-none" data-edit-target="name">{{ section.name }}</h2>
        
        <!-- Icons (Open All) -->
        <a href="#" 
           onclick="openAllLinksInSection(this); return false;" 
           class="text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-100 edit-mode-hidden"
           title="Open all links">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
           </svg>
        </a>
        
        <!-- Edit Icon (Visual cue) -->
        {% if not is_preview %}
        <div class="hidden edit-mode-visible text-neutral-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
        </div>
        {% endif %}
    </div>

    <!-- Content Wrapper -->
    <div class="flex flex-col gap-2 flex-grow overflow-hidden">
        
        <!-- Links Sortable Container -->
        <!-- Added flex-grow so this container consumes all empty space, making the drop target larger -->
        <!-- Added overflow-y-auto so links scroll inside the card if they exceed height -->
        <div class="flex flex-col gap-2 min-h-[10px] section-links flex-grow overflow-y-auto overflow-x-visible" 
             {% if not is_preview %}data-section-id="{{ section.id }}"{% endif %}>
            
            {% for link in section.links.all %}
                <div class="{% if not is_preview %}draggable-link{% endif %} 
                            relative px-3 py-0.5 rounded 
                            hover:bg-neutral-100 dark:hover:bg-neutral-600 group-hover:bg-opacity-50
                            transition-colors duration-150
                            border-2 border-transparent"
                     {% if not is_preview %}data-id="{{ link.id }}"{% endif %}>
                     
                    <!-- Normal Link Behavior -->
                    <a href="{{ link.url }}" 
                       target="_blank"
                       class="edit-mode-disable block text-neutral-700 dark:text-neutral-400 hover:underline truncate"
                       data-edit-target="name">
                       {{ link.name }}
                    </a>
                    
                    <!-- Overlay for Dragging -->
                    {% if not is_preview %}
                    <div class="absolute inset-0 hidden edit-mode-overlay cursor-grab active:cursor-grabbing z-10"></div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <!-- Add Link Button (Edit Mode Only, Max 10) -->
        <!-- Because section-links above has flex-grow, this button will sit at the bottom of the card -->
        {% if not is_preview %}
        <div class="mt-auto" id="add-btn-container-{{ section.id }}">
            <button onclick="openAddLinkModal('{{ section.id }}')"
                    class="static-add-btn w-full py-0.75 hidden edit-mode-visible cursor-pointer
                           border-2 border-dotted border-neutral-400 dark:border-neutral-500 rounded
                           text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-600/50
                           justify-center items-center transition-all"
                    title="Add Link"
                    {% if section.links.count >= 10 %}style="display:none !important"{% endif %}>
                 <span class="text-md font-bold leading-normal">+</span>
            </button>
        </div>
        {% endif %}
        
    </div>
</section>